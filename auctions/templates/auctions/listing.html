{% extends 'auctions/layout.html' %}

{% block body %}
{% if message %}
    <p>{{ message }}</p>
{% endif %}
<main>
    <section> <!-- Display information -->
        <div>
            <img src="{{ listing.image }}" alt="Picture of shovel" style="width:300px">
        </div>
        <div>
        {% if is_owner %}
        <strong>Your listing</strong>
        <br>
        {% endif %}

        {{ listing.title }}
        <br>
        {{ listing.description }}
        {% if listing.active_status %}
        <p>Status: Active</p>
        {% else %}
        <p>Status: Inactive</p>
        {% endif %}
        </div>
        <hr>
    </section>
    <section>
        {% if not is_owner %}
        <div>
            {% if not listing.bids.count == 0 %} <!-- Display price -->
            <div>
                <h6>Current price:</h6>
                <h4><strong>US ${{ current_price }}</strong></h4>
            </div>
            {% else %}
            <div>
                <h6>Start bid:</h6>
                <h4><strong>US ${{ current_price }} </strong></h4>
            </div>
            {% endif %}
            <div> <!-- Display the ammout of bids -->
                {{ listing.bids.count }}
                {% if listing.bids.count == 1 %} 
                    bid
                {% else %}
                    bids
                {% endif %}
            </div>
        </div>
        <div>
            <!-- Input bid -->
            <form action="{% url 'bid' listing.id %}", method="POST">
                {% csrf_token %}
                <input name="bid" type="number" step= 0.01 placeholder="Bid">
                <input type="submit" value="Place bid">
            </form>
            <!-- Display watchlist -->
            {% if not is_watching %}
            <form action="{% url 'watchlist' listing.id %}" method="POST">
                {% csrf_token %}
                <input type="submit" value="Add to watchlist">
            </form>
            {% else %}
            <form action="{% url 'delete_watchlist' listing.id %}" method="POST">
                {% csrf_token %}
                <input type="submit" value="Unwatch">
            </form>
            {% endif %}
        </div>
        {% else %}
        <form action="{% url 'status' listing.id %}" method="POST">
            {% csrf_token %}
            <input type="submit" value="Change status">
        </form>
        {% endif %}
    </section>
    <hr>
</main>

<main>
    <h2>Comments</h2>
    <div>
        <form action="{% url 'comment' listing.id %}" method="POST">
            {% csrf_token %}
            <input name="message" type="text" placeholder="Add comment...">
            <input type="submit" value="Comment">
        </form>
    </div>
    {% for comment in comments %}
    <div>
        <h5><strong>{{ comment.commentator }}</strong>
            {{ comment.time }}
            {% if is_modified %} (edited) {% endif %}
        </h5>
        <p>{{ comment.message }}</p>
    </div>
    {% endfor %}
</main>
{% endblock body %}